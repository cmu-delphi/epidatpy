<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Accessing versioned data &#8212; epidatpy 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=039e1c02" />
    <link rel="stylesheet" type="text/css" href="_static/nbsphinx-code-cells.css?v=a35ea3b2" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=af2ce170"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="epidatpy Reference" href="epidatpy.html" />
    <link rel="prev" title="Finding data of interest" href="signal_discovery.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="Accessing-versioned-data">
<h1>Accessing versioned data<a class="headerlink" href="#Accessing-versioned-data" title="Permalink to this heading">¶</a></h1>
<p>The Delphi Epidata API stores not just each signal’s estimate for a given location on a given day, but also <em>when</em> that estimate was made, and all updates to that estimate.</p>
<p>For example, let’s look at the <a class="reference external" href="https://cmu-delphi.github.io/delphi-epidata/api/covidcast-signals/doctor-visits.html">doctor visits signal</a> from the <a class="reference external" href="https://cmu-delphi.github.io/delphi-epidata/api/covidcast.html">covidcast endpoint</a>, which estimates the percentage of outpatient doctor visits that are COVID-related.</p>
<p>Consider a result row with <code class="docutils literal notranslate"><span class="pre">time_value</span> <span class="pre">=</span> <span class="pre">2020-05-01</span></code> for <code class="docutils literal notranslate"><span class="pre">geo_values</span> <span class="pre">=</span> <span class="pre">&quot;pa&quot;</span></code>. This is an estimate for Pennsylvania on May 1, 2020. That estimate was <em>issued</em> on May 5, 2020 (which is recorded in the <code class="docutils literal notranslate"><span class="pre">issue</span></code> column), the delay coming from a combination of:</p>
<ul class="simple">
<li><p>time taken by our data partner to collect the data</p></li>
<li><p>time taken by the Dekohu Epidata API to ingest the data provided.</p></li>
</ul>
<p>Later, the estimate for May 1st could be updated, perhaps because additional visit data from May 1st arrived at our source and was reported to us. This constitutes a new <em>issue</em> of the data.</p>
<section id="Data-known-%22as-of%22-a-specific-date">
<h2>Data known “as of” a specific date<a class="headerlink" href="#Data-known-%22as-of%22-a-specific-date" title="Permalink to this heading">¶</a></h2>
<p>By default, endpoint functions fetch the most recent issue available. This is the best option for users who simply want to graph the latest data or construct dashboards. But if we are interested in knowing <em>when</em> data was reported, we can request specific data versions using the <code class="docutils literal notranslate"><span class="pre">as_of</span></code>, <code class="docutils literal notranslate"><span class="pre">issues</span></code>, or <code class="docutils literal notranslate"><span class="pre">lag</span></code> arguments (note that these are mutually exclusive and that not all endpoints aside from <code class="docutils literal notranslate"><span class="pre">pub_covidcast</span></code> support all three parameters, so please check the documentation for that
specific endpoint).</p>
<p>First, we can request the data that was available <em>as it was available</em> on a specific date, using the <code class="docutils literal notranslate"><span class="pre">as_of</span></code> argument:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">epidatpy</span> <span class="kn">import</span> <span class="n">EpiDataContext</span><span class="p">,</span> <span class="n">EpiRange</span>

<span class="n">epidata</span> <span class="o">=</span> <span class="n">EpiDataContext</span><span class="p">(</span><span class="n">use_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Obtain the most up-to-date version of the smoothed covid-like illness (CLI)</span>
<span class="c1"># signal from the COVID-19 Trends and Impact survey for the US</span>
<span class="n">epidata</span><span class="o">.</span><span class="n">pub_covidcast</span><span class="p">(</span>
    <span class="n">data_source</span><span class="o">=</span><span class="s2">&quot;doctor-visits&quot;</span><span class="p">,</span>
    <span class="n">signals</span><span class="o">=</span><span class="s2">&quot;smoothed_cli&quot;</span><span class="p">,</span>
    <span class="n">time_type</span><span class="o">=</span><span class="s2">&quot;day&quot;</span><span class="p">,</span>
    <span class="n">time_values</span><span class="o">=</span><span class="s2">&quot;2020-05-01&quot;</span><span class="p">,</span>
    <span class="n">geo_type</span><span class="o">=</span><span class="s2">&quot;state&quot;</span><span class="p">,</span>
    <span class="n">geo_values</span><span class="o">=</span><span class="s2">&quot;pa&quot;</span><span class="p">,</span>
    <span class="n">as_of</span><span class="o">=</span><span class="s2">&quot;2020-05-07&quot;</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">df</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>source</th>
      <th>signal</th>
      <th>geo_type</th>
      <th>geo_value</th>
      <th>time_type</th>
      <th>time_value</th>
      <th>issue</th>
      <th>lag</th>
      <th>value</th>
      <th>stderr</th>
      <th>sample_size</th>
      <th>direction</th>
      <th>missing_value</th>
      <th>missing_stderr</th>
      <th>missing_sample_size</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>doctor-visits</td>
      <td>smoothed_cli</td>
      <td>state</td>
      <td>pa</td>
      <td>day</td>
      <td>2020-05-01</td>
      <td>2020-05-07</td>
      <td>6</td>
      <td>2.32192</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>0</td>
      <td>5</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>This shows that an estimate of about 2.3% was issued on May 7. If we don’t specify <code class="docutils literal notranslate"><span class="pre">as_of</span></code>, we get the most recent estimate available:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epidata</span><span class="o">.</span><span class="n">pub_covidcast</span><span class="p">(</span>
    <span class="n">data_source</span><span class="o">=</span><span class="s2">&quot;doctor-visits&quot;</span><span class="p">,</span>
    <span class="n">signals</span><span class="o">=</span><span class="s2">&quot;smoothed_cli&quot;</span><span class="p">,</span>
    <span class="n">time_type</span><span class="o">=</span><span class="s2">&quot;day&quot;</span><span class="p">,</span>
    <span class="n">time_values</span><span class="o">=</span><span class="s2">&quot;2020-05-01&quot;</span><span class="p">,</span>
    <span class="n">geo_type</span><span class="o">=</span><span class="s2">&quot;state&quot;</span><span class="p">,</span>
    <span class="n">geo_values</span><span class="o">=</span><span class="s2">&quot;pa&quot;</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">df</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>source</th>
      <th>signal</th>
      <th>geo_type</th>
      <th>geo_value</th>
      <th>time_type</th>
      <th>time_value</th>
      <th>issue</th>
      <th>lag</th>
      <th>value</th>
      <th>stderr</th>
      <th>sample_size</th>
      <th>direction</th>
      <th>missing_value</th>
      <th>missing_stderr</th>
      <th>missing_sample_size</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>doctor-visits</td>
      <td>smoothed_cli</td>
      <td>state</td>
      <td>pa</td>
      <td>day</td>
      <td>2020-05-01</td>
      <td>2020-07-04</td>
      <td>64</td>
      <td>5.075015</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>0</td>
      <td>5</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Note the substantial change in the estimate, from less than 3% to over 5%, reflecting new data that became available after May 7 about visits <em>occurring on</em> May 1. This illustrates the importance of issue date tracking, particularly for forecasting tasks. To backtest a forecasting model on past data, it is important to use the data that would have been available <em>at the time</em> the model was or would have been fit, not data that arrived much later.</p>
<p>By plotting API results with different values of the <code class="docutils literal notranslate"><span class="pre">as_of</span></code> parameter, we can see how the indicator value changes over time as new observations become available:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.dpi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span>

<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">as_of_date</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;2020-05-07&quot;</span><span class="p">,</span> <span class="s2">&quot;2020-05-14&quot;</span><span class="p">,</span> <span class="s2">&quot;2020-05-21&quot;</span><span class="p">,</span> <span class="s2">&quot;2020-05-28&quot;</span><span class="p">]:</span>
    <span class="n">apicall</span> <span class="o">=</span> <span class="n">epidata</span><span class="o">.</span><span class="n">pub_covidcast</span><span class="p">(</span>
        <span class="n">data_source</span><span class="o">=</span><span class="s2">&quot;doctor-visits&quot;</span><span class="p">,</span>
        <span class="n">signals</span><span class="o">=</span><span class="s2">&quot;smoothed_adj_cli&quot;</span><span class="p">,</span>
        <span class="n">time_type</span><span class="o">=</span><span class="s2">&quot;day&quot;</span><span class="p">,</span>
        <span class="n">time_values</span><span class="o">=</span><span class="n">EpiRange</span><span class="p">(</span><span class="s2">&quot;2020-04-20&quot;</span><span class="p">,</span> <span class="s2">&quot;2020-04-27&quot;</span><span class="p">),</span>
        <span class="n">geo_type</span><span class="o">=</span><span class="s2">&quot;state&quot;</span><span class="p">,</span>
        <span class="n">geo_values</span><span class="o">=</span><span class="s2">&quot;pa&quot;</span><span class="p">,</span>
        <span class="n">as_of</span><span class="o">=</span><span class="n">as_of_date</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">apicall</span><span class="o">.</span><span class="n">df</span><span class="p">())</span>

<span class="n">final_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="n">final_df</span><span class="p">[</span><span class="s2">&quot;issue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_df</span><span class="p">[</span><span class="s2">&quot;issue&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="n">final_df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;time_value&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;issue&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;CLI&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Smoothed CLI from Doctor Visits&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/versioned_data_6_0.png" src="_images/versioned_data_6_0.png" />
</div>
</div>
</section>
<section id="Multiple-issues-of-observations">
<h2>Multiple issues of observations<a class="headerlink" href="#Multiple-issues-of-observations" title="Permalink to this heading">¶</a></h2>
<p>By using the <code class="docutils literal notranslate"><span class="pre">issues</span></code> argument, we can request all issues in a certain time period:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epidata</span><span class="o">.</span><span class="n">pub_covidcast</span><span class="p">(</span>
    <span class="n">data_source</span><span class="o">=</span><span class="s2">&quot;doctor-visits&quot;</span><span class="p">,</span>
    <span class="n">signals</span><span class="o">=</span><span class="s2">&quot;smoothed_adj_cli&quot;</span><span class="p">,</span>
    <span class="n">time_type</span><span class="o">=</span><span class="s2">&quot;day&quot;</span><span class="p">,</span>
    <span class="n">time_values</span><span class="o">=</span><span class="s2">&quot;2020-05-01&quot;</span><span class="p">,</span>
    <span class="n">geo_type</span><span class="o">=</span><span class="s2">&quot;state&quot;</span><span class="p">,</span>
    <span class="n">geo_values</span><span class="o">=</span><span class="s2">&quot;pa&quot;</span><span class="p">,</span>
    <span class="n">issues</span><span class="o">=</span><span class="n">EpiRange</span><span class="p">(</span><span class="s2">&quot;2020-05-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2020-05-15&quot;</span><span class="p">),</span>
<span class="p">)</span><span class="o">.</span><span class="n">df</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>source</th>
      <th>signal</th>
      <th>geo_type</th>
      <th>geo_value</th>
      <th>time_type</th>
      <th>time_value</th>
      <th>issue</th>
      <th>lag</th>
      <th>value</th>
      <th>stderr</th>
      <th>sample_size</th>
      <th>direction</th>
      <th>missing_value</th>
      <th>missing_stderr</th>
      <th>missing_sample_size</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>doctor-visits</td>
      <td>smoothed_adj_cli</td>
      <td>state</td>
      <td>pa</td>
      <td>day</td>
      <td>2020-05-01</td>
      <td>2020-05-07</td>
      <td>6</td>
      <td>2.581509</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>0</td>
      <td>5</td>
      <td>5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>doctor-visits</td>
      <td>smoothed_adj_cli</td>
      <td>state</td>
      <td>pa</td>
      <td>day</td>
      <td>2020-05-01</td>
      <td>2020-05-08</td>
      <td>7</td>
      <td>3.278896</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>0</td>
      <td>5</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>doctor-visits</td>
      <td>smoothed_adj_cli</td>
      <td>state</td>
      <td>pa</td>
      <td>day</td>
      <td>2020-05-01</td>
      <td>2020-05-09</td>
      <td>8</td>
      <td>3.321781</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>0</td>
      <td>5</td>
      <td>5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>doctor-visits</td>
      <td>smoothed_adj_cli</td>
      <td>state</td>
      <td>pa</td>
      <td>day</td>
      <td>2020-05-01</td>
      <td>2020-05-12</td>
      <td>11</td>
      <td>3.588683</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>0</td>
      <td>5</td>
      <td>5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>doctor-visits</td>
      <td>smoothed_adj_cli</td>
      <td>state</td>
      <td>pa</td>
      <td>day</td>
      <td>2020-05-01</td>
      <td>2020-05-13</td>
      <td>12</td>
      <td>3.631978</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>0</td>
      <td>5</td>
      <td>5</td>
    </tr>
    <tr>
      <th>5</th>
      <td>doctor-visits</td>
      <td>smoothed_adj_cli</td>
      <td>state</td>
      <td>pa</td>
      <td>day</td>
      <td>2020-05-01</td>
      <td>2020-05-14</td>
      <td>13</td>
      <td>3.658009</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>0</td>
      <td>5</td>
      <td>5</td>
    </tr>
    <tr>
      <th>6</th>
      <td>doctor-visits</td>
      <td>smoothed_adj_cli</td>
      <td>state</td>
      <td>pa</td>
      <td>day</td>
      <td>2020-05-01</td>
      <td>2020-05-15</td>
      <td>14</td>
      <td>3.662286</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>0</td>
      <td>5</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>This estimate was clearly updated many times as new data for May 1st arrived. Note that these results include only data issued or updated between (inclusive) 2020-05-01 and 2020-05-15. If a value was first reported on 2020-04-15, and never updated, a query for issues between 2020-05-01 and 2020-05-15 will not include that value among its results. This view of the data is useful for understanding the revision patterns in a signal and can be useful for nowcasting (i.e. the practice of
auto-correcting real-time estimates).</p>
</section>
<section id="Observations-issued-with-a-specific-lag">
<h2>Observations issued with a specific lag<a class="headerlink" href="#Observations-issued-with-a-specific-lag" title="Permalink to this heading">¶</a></h2>
<p>Finally, we can use the <code class="docutils literal notranslate"><span class="pre">lag</span></code> argument to request only data reported with a certain lag. For example, requesting a lag of 7 days fetches only data issued exactly 7 days after the corresponding <code class="docutils literal notranslate"><span class="pre">time_value</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epidata</span><span class="o">.</span><span class="n">pub_covidcast</span><span class="p">(</span>
    <span class="n">data_source</span><span class="o">=</span><span class="s2">&quot;doctor-visits&quot;</span><span class="p">,</span>
    <span class="n">signals</span><span class="o">=</span><span class="s2">&quot;smoothed_adj_cli&quot;</span><span class="p">,</span>
    <span class="n">time_type</span><span class="o">=</span><span class="s2">&quot;day&quot;</span><span class="p">,</span>
    <span class="n">time_values</span><span class="o">=</span><span class="n">EpiRange</span><span class="p">(</span><span class="s2">&quot;2020-05-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2020-05-01&quot;</span><span class="p">),</span>
    <span class="n">geo_type</span><span class="o">=</span><span class="s2">&quot;state&quot;</span><span class="p">,</span>
    <span class="n">geo_values</span><span class="o">=</span><span class="s2">&quot;pa&quot;</span><span class="p">,</span>
    <span class="n">lag</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">df</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>source</th>
      <th>signal</th>
      <th>geo_type</th>
      <th>geo_value</th>
      <th>time_type</th>
      <th>time_value</th>
      <th>issue</th>
      <th>lag</th>
      <th>value</th>
      <th>stderr</th>
      <th>sample_size</th>
      <th>direction</th>
      <th>missing_value</th>
      <th>missing_stderr</th>
      <th>missing_sample_size</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>doctor-visits</td>
      <td>smoothed_adj_cli</td>
      <td>state</td>
      <td>pa</td>
      <td>day</td>
      <td>2020-05-01</td>
      <td>2020-05-08</td>
      <td>7</td>
      <td>3.278896</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>0</td>
      <td>5</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Note that though this query requested all values between 2020-05-01 and 2020-05-07, May 3rd and May 4th were <em>not</em> included in the results set. This is because the query will only include a result for May 3rd if a value were issued on May 10th (a 7-day lag), but in fact the value was not updated on that day:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epidata</span><span class="o">.</span><span class="n">pub_covidcast</span><span class="p">(</span>
    <span class="n">data_source</span><span class="o">=</span><span class="s2">&quot;doctor-visits&quot;</span><span class="p">,</span>
    <span class="n">signals</span><span class="o">=</span><span class="s2">&quot;smoothed_adj_cli&quot;</span><span class="p">,</span>
    <span class="n">time_type</span><span class="o">=</span><span class="s2">&quot;day&quot;</span><span class="p">,</span>
    <span class="n">time_values</span><span class="o">=</span><span class="s2">&quot;2020-05-03&quot;</span><span class="p">,</span>
    <span class="n">geo_type</span><span class="o">=</span><span class="s2">&quot;state&quot;</span><span class="p">,</span>
    <span class="n">geo_values</span><span class="o">=</span><span class="s2">&quot;pa&quot;</span><span class="p">,</span>
    <span class="n">issues</span><span class="o">=</span><span class="n">EpiRange</span><span class="p">(</span><span class="s2">&quot;2020-05-09&quot;</span><span class="p">,</span> <span class="s2">&quot;2020-05-15&quot;</span><span class="p">),</span>
<span class="p">)</span><span class="o">.</span><span class="n">df</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>source</th>
      <th>signal</th>
      <th>geo_type</th>
      <th>geo_value</th>
      <th>time_type</th>
      <th>time_value</th>
      <th>issue</th>
      <th>lag</th>
      <th>value</th>
      <th>stderr</th>
      <th>sample_size</th>
      <th>direction</th>
      <th>missing_value</th>
      <th>missing_stderr</th>
      <th>missing_sample_size</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>doctor-visits</td>
      <td>smoothed_adj_cli</td>
      <td>state</td>
      <td>pa</td>
      <td>day</td>
      <td>2020-05-03</td>
      <td>2020-05-09</td>
      <td>6</td>
      <td>2.788618</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>0</td>
      <td>5</td>
      <td>5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>doctor-visits</td>
      <td>smoothed_adj_cli</td>
      <td>state</td>
      <td>pa</td>
      <td>day</td>
      <td>2020-05-03</td>
      <td>2020-05-12</td>
      <td>9</td>
      <td>3.015368</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>0</td>
      <td>5</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>doctor-visits</td>
      <td>smoothed_adj_cli</td>
      <td>state</td>
      <td>pa</td>
      <td>day</td>
      <td>2020-05-03</td>
      <td>2020-05-13</td>
      <td>10</td>
      <td>3.03931</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>0</td>
      <td>5</td>
      <td>5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>doctor-visits</td>
      <td>smoothed_adj_cli</td>
      <td>state</td>
      <td>pa</td>
      <td>day</td>
      <td>2020-05-03</td>
      <td>2020-05-14</td>
      <td>11</td>
      <td>3.021245</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>0</td>
      <td>5</td>
      <td>5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>doctor-visits</td>
      <td>smoothed_adj_cli</td>
      <td>state</td>
      <td>pa</td>
      <td>day</td>
      <td>2020-05-03</td>
      <td>2020-05-15</td>
      <td>12</td>
      <td>3.048725</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>0</td>
      <td>5</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">epidatpy</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="signal_discovery.html">Finding data of interest</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Accessing versioned data</a></li>
<li class="toctree-l1"><a class="reference internal" href="epidatpy.html">epidatpy Reference</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="https://delphi.cmu.edu/">Delphi Research Group</a></li>
    
    <li class="toctree-l1"><a href="https://cmu-delphi.github.io/delphi-epidata">Delphi Epidata API</a></li>
    
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="signal_discovery.html" title="previous chapter">Finding data of interest</a></li>
      <li>Next: <a href="epidatpy.html" title="next chapter">epidatpy Reference</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2024, Delphi Research Group.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/versioned_data.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>